import { createHotContext as __vite__createHotContext } from "/@vite/client";import.meta.hot = __vite__createHotContext("/src/context/CometContext.tsx");import __vite__cjsImport0_react_jsxDevRuntime from "/node_modules/.vite/deps/react_jsx-dev-runtime.js?v=b37f1152"; const jsxDEV = __vite__cjsImport0_react_jsxDevRuntime["jsxDEV"];
import * as RefreshRuntime from "/@react-refresh";
const inWebWorker = typeof WorkerGlobalScope !== "undefined" && self instanceof WorkerGlobalScope;
let prevRefreshReg;
let prevRefreshSig;
if (import.meta.hot && !inWebWorker) {
  if (!window.$RefreshReg$) {
    throw new Error(
      "@vitejs/plugin-react can't detect preamble. Something is wrong."
    );
  }
  prevRefreshReg = window.$RefreshReg$;
  prevRefreshSig = window.$RefreshSig$;
  window.$RefreshReg$ = RefreshRuntime.getRefreshReg("C:/Users/admin/Desktop/HILO_CASE/Comet-X/src/context/CometContext.tsx");
  window.$RefreshSig$ = RefreshRuntime.createSignatureFunctionForTransform;
}
var _s = $RefreshSig$(), _s2 = $RefreshSig$();
import __vite__cjsImport3_react from "/node_modules/.vite/deps/react.js?v=b37f1152"; const createContext = __vite__cjsImport3_react["createContext"]; const useContext = __vite__cjsImport3_react["useContext"]; const useState = __vite__cjsImport3_react["useState"]; const useCallback = __vite__cjsImport3_react["useCallback"];
import { v4 as uuidv4 } from "/node_modules/.vite/deps/uuid.js?v=f58bc251";
const BRAIN_API = "http://localhost:8080";
const CometContext = createContext(null);
const sensoryLobe = {
  process: (input) => {
    const dangerousPatterns = [/<script/gi, /javascript:/gi, /eval\(/gi];
    const safe = !dangerousPatterns.some((p) => p.test(input));
    let intent = "unknown";
    if (input.startsWith("comet ") || input.startsWith("comet mission")) {
      intent = "command";
    } else if (input.includes("?")) {
      intent = "question";
    } else if (input.match(/^https?:\/\//)) {
      intent = "navigate";
    } else {
      intent = "search";
    }
    return {
      safe,
      sanitized: input.trim(),
      intent
    };
  }
};
const cognitiveLobe = {
  process: async (input, intent) => {
    if (intent === "command") {
      const parts = input.replace(/^comet (mission )?/i, "").split(" ");
      const action = parts[0];
      const params = parts.slice(1).join(" ");
      switch (action) {
        case "open":
        case "goto":
          return { action: "navigate", params: { url: params } };
        case "search":
          return { action: "search", params: { query: params } };
        case "newtab":
          return { action: "newtab", params: {} };
        case "close":
          return { action: "close", params: {} };
        case "tabs":
          return { action: "list-tabs", params: {} };
        case "ask":
          return { action: "ai-query", params: { question: params } };
        default:
          return { action: "unknown", params: { raw: input } };
      }
    }
    if (intent === "navigate") {
      return { action: "navigate", params: { url: input } };
    }
    if (intent === "search") {
      return { action: "search", params: { query: input } };
    }
    return { action: "ai-query", params: { question: input } };
  }
};
const executiveLobe = {
  execute: async (action, params, context) => {
    switch (action) {
      case "navigate":
        const url = params.url.startsWith("http") ? params.url : `https://${params.url}`;
        context.navigate(url);
        return `âœ“ Navigating to: ${url}`;
      case "search":
        const searchUrl = `https://www.google.com/search?q=${encodeURIComponent(params.query)}`;
        context.navigate(searchUrl);
        return `âœ“ Searching for: ${params.query}`;
      case "newtab":
        context.createTab();
        return "âœ“ New tab created";
      case "close":
        if (context.activeTabId) {
          context.closeTab(context.activeTabId);
          return "âœ“ Tab closed";
        }
        return "âœ— No active tab to close";
      case "list-tabs":
        const tabList = context.tabs.map((t, i) => `${i + 1}. ${t.title || "New Tab"} - ${t.url || "comet://newtab"}`).join("\n");
        return `ðŸ“‘ Open Tabs:
${tabList}`;
      case "ai-query":
        try {
          const response = await fetch(`${BRAIN_API}/mission`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ command: params.question })
          });
          const data = await response.json();
          return `ðŸ§  AI Response:
${data.final_response || data.status}`;
        } catch (error) {
          return `ðŸ§  AI Response (Offline Mode):
Backend not available. Processing locally...

Question: "${params.question}"`;
        }
      default:
        return `â“ Unknown command. Type 'help' for available commands.`;
    }
  }
};
export const CometProvider = ({ children }) => {
  _s();
  const [tabs, setTabs] = useState(
    [
      { id: uuidv4(), url: "comet://newtab", title: "New Tab", isLoading: false }
    ]
  );
  const [activeTabId, setActiveTabId] = useState(tabs[0]?.id || null);
  const [isProcessing, setIsProcessing] = useState(false);
  const [currentLobe, setCurrentLobe] = useState(null);
  const setActiveTab = useCallback((id) => {
    setActiveTabId(id);
  }, []);
  const createTab = useCallback((url) => {
    const newTab = {
      id: uuidv4(),
      url: url || "comet://newtab",
      title: url ? "Loading..." : "New Tab",
      isLoading: !!url
    };
    setTabs((prev) => [...prev, newTab]);
    setActiveTabId(newTab.id);
  }, []);
  const closeTab = useCallback((id) => {
    setTabs((prev) => {
      const newTabs = prev.filter((t) => t.id !== id);
      if (newTabs.length === 0) {
        const newTab = {
          id: uuidv4(),
          url: "comet://newtab",
          title: "New Tab",
          isLoading: false
        };
        return [newTab];
      }
      return newTabs;
    });
    if (activeTabId === id) {
      setTabs((prev) => {
        const index = prev.findIndex((t) => t.id === id);
        const newActiveId = prev[index - 1]?.id || prev[index + 1]?.id || prev[0]?.id;
        setActiveTabId(newActiveId);
        return prev;
      });
    }
  }, [activeTabId]);
  const navigate = useCallback((url) => {
    if (!activeTabId) {
      createTab(url);
      return;
    }
    setTabs(
      (prev) => prev.map(
        (t) => t.id === activeTabId ? { ...t, url, title: "Loading...", isLoading: true } : t
      )
    );
  }, [activeTabId, createTab]);
  const executeCommand = useCallback(async (command) => {
    setIsProcessing(true);
    try {
      setCurrentLobe("sensory");
      await new Promise((r) => setTimeout(r, 200));
      const sensoryResult = sensoryLobe.process(command);
      if (!sensoryResult.safe) {
        setCurrentLobe(null);
        setIsProcessing(false);
        return "ðŸ›¡ï¸ SECURITY: Potentially unsafe input blocked.";
      }
      setCurrentLobe("cognitive");
      await new Promise((r) => setTimeout(r, 300));
      const cognitiveResult = await cognitiveLobe.process(
        sensoryResult.sanitized,
        sensoryResult.intent
      );
      setCurrentLobe("executive");
      await new Promise((r) => setTimeout(r, 200));
      const result = await executiveLobe.execute(cognitiveResult.action, cognitiveResult.params, {
        createTab,
        closeTab,
        navigate,
        tabs,
        activeTabId
      });
      return result;
    } finally {
      setCurrentLobe(null);
      setIsProcessing(false);
    }
  }, [createTab, closeTab, navigate, tabs, activeTabId]);
  const value = {
    tabs,
    activeTabId,
    setActiveTab,
    createTab,
    closeTab,
    navigate,
    isProcessing,
    currentLobe,
    executeCommand
  };
  return /* @__PURE__ */ jsxDEV(CometContext.Provider, { value, children }, void 0, false, {
    fileName: "C:/Users/admin/Desktop/HILO_CASE/Comet-X/src/context/CometContext.tsx",
    lineNumber: 326,
    columnNumber: 5
  }, this);
};
_s(CometProvider, "c4L+6cI3XN6lES25OXH6B//rMsI=");
_c = CometProvider;
export const useComet = () => {
  _s2();
  const context = useContext(CometContext);
  if (!context) {
    throw new Error("useComet must be used within CometProvider");
  }
  return context;
};
_s2(useComet, "b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=");
export default CometContext;
var _c;
$RefreshReg$(_c, "CometProvider");
if (import.meta.hot && !inWebWorker) {
  window.$RefreshReg$ = prevRefreshReg;
  window.$RefreshSig$ = prevRefreshSig;
}
if (import.meta.hot && !inWebWorker) {
  RefreshRuntime.__hmr_import(import.meta.url).then((currentExports) => {
    RefreshRuntime.registerExportsForReactRefresh("C:/Users/admin/Desktop/HILO_CASE/Comet-X/src/context/CometContext.tsx", currentExports);
    import.meta.hot.accept((nextExports) => {
      if (!nextExports) return;
      const invalidateMessage = RefreshRuntime.validateRefreshBoundaryAndEnqueueUpdate("C:/Users/admin/Desktop/HILO_CASE/Comet-X/src/context/CometContext.tsx", currentExports, nextExports);
      if (invalidateMessage) import.meta.hot.invalidate(invalidateMessage);
    });
  });
}

//# sourceMappingURL=data:application/json;base64,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O0FBQUV3RCxJQU5XRCxVQUFRO0FBUXJCLGVBQWVwRjtBQUFhLElBQUFtRjtBQUFBSSxhQUFBSixJQUFBIiwibmFtZXMiOlsiY3JlYXRlQ29udGV4dCIsInVzZUNvbnRleHQiLCJ1c2VTdGF0ZSIsInVzZUNhbGxiYWNrIiwidjQiLCJ1dWlkdjQiLCJCUkFJTl9BUEkiLCJDb21ldENvbnRleHQiLCJzZW5zb3J5TG9iZSIsInByb2Nlc3MiLCJpbnB1dCIsImRhbmdlcm91c1BhdHRlcm5zIiwic2FmZSIsInNvbWUiLCJwIiwidGVzdCIsImludGVudCIsInN0YXJ0c1dpdGgiLCJpbmNsdWRlcyIsIm1hdGNoIiwic2FuaXRpemVkIiwidHJpbSIsImNvZ25pdGl2ZUxvYmUiLCJwYXJ0cyIsInJlcGxhY2UiLCJzcGxpdCIsImFjdGlvbiIsInBhcmFtcyIsInNsaWNlIiwiam9pbiIsInVybCIsInF1ZXJ5IiwicXVlc3Rpb24iLCJyYXciLCJleGVjdXRpdmVMb2JlIiwiZXhlY3V0ZSIsImNvbnRleHQiLCJuYXZpZ2F0ZSIsInNlYXJjaFVybCIsImVuY29kZVVSSUNvbXBvbmVudCIsImNyZWF0ZVRhYiIsImFjdGl2ZVRhYklkIiwiY2xvc2VUYWIiLCJ0YWJMaXN0IiwidGFicyIsIm1hcCIsInQiLCJpIiwidGl0bGUiLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbWFuZCIsImRhdGEiLCJqc29uIiwiZmluYWxfcmVzcG9uc2UiLCJzdGF0dXMiLCJlcnJvciIsIkNvbWV0UHJvdmlkZXIiLCJjaGlsZHJlbiIsIl9zIiwic2V0VGFicyIsImlkIiwiaXNMb2FkaW5nIiwic2V0QWN0aXZlVGFiSWQiLCJpc1Byb2Nlc3NpbmciLCJzZXRJc1Byb2Nlc3NpbmciLCJjdXJyZW50TG9iZSIsInNldEN1cnJlbnRMb2JlIiwic2V0QWN0aXZlVGFiIiwibmV3VGFiIiwicHJldiIsIm5ld1RhYnMiLCJmaWx0ZXIiLCJsZW5ndGgiLCJpbmRleCIsImZpbmRJbmRleCIsIm5ld0FjdGl2ZUlkIiwiZXhlY3V0ZUNvbW1hbmQiLCJQcm9taXNlIiwiciIsInNldFRpbWVvdXQiLCJzZW5zb3J5UmVzdWx0IiwiY29nbml0aXZlUmVzdWx0IiwicmVzdWx0IiwidmFsdWUiLCJfYyIsInVzZUNvbWV0IiwiX3MyIiwiRXJyb3IiLCIkUmVmcmVzaFJlZyQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZXMiOlsiQ29tZXRDb250ZXh0LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICog8J+noCBDT01FVCBDT05URVhUXHJcbiAqIFRocmVlLUxvYmUgQXJjaGl0ZWN0dXJlIFN0YXRlIE1hbmFnZW1lbnRcclxuICogQ29ubmVjdGVkIHRvIFB5dGhvbiBCYWNrZW5kIChQb3J0IDgwODApXHJcbiAqL1xyXG5cclxuaW1wb3J0IFJlYWN0LCB7IGNyZWF0ZUNvbnRleHQsIHVzZUNvbnRleHQsIHVzZVN0YXRlLCB1c2VDYWxsYmFjaywgUmVhY3ROb2RlIH0gZnJvbSAncmVhY3QnO1xyXG5pbXBvcnQgeyB2NCBhcyB1dWlkdjQgfSBmcm9tICd1dWlkJztcclxuXHJcbi8vIEJhY2tlbmQgQVBJIFVSTFxyXG5jb25zdCBCUkFJTl9BUEkgPSAnaHR0cDovL2xvY2FsaG9zdDo4MDgwJztcclxuXHJcbi8vIFR5cGVzXHJcbmludGVyZmFjZSBUYWIge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgdXJsOiBzdHJpbmc7XHJcbiAgdGl0bGU6IHN0cmluZztcclxuICBmYXZpY29uPzogc3RyaW5nO1xyXG4gIGlzTG9hZGluZzogYm9vbGVhbjtcclxufVxyXG5cclxudHlwZSBMb2JlID0gJ3NlbnNvcnknIHwgJ2NvZ25pdGl2ZScgfCAnZXhlY3V0aXZlJyB8IG51bGw7XHJcblxyXG5pbnRlcmZhY2UgQ29tZXRDb250ZXh0VHlwZSB7XHJcbiAgLy8gVGFic1xyXG4gIHRhYnM6IFRhYltdO1xyXG4gIGFjdGl2ZVRhYklkOiBzdHJpbmcgfCBudWxsO1xyXG4gIHNldEFjdGl2ZVRhYjogKGlkOiBzdHJpbmcpID0+IHZvaWQ7XHJcbiAgY3JlYXRlVGFiOiAodXJsPzogc3RyaW5nKSA9PiB2b2lkO1xyXG4gIGNsb3NlVGFiOiAoaWQ6IHN0cmluZykgPT4gdm9pZDtcclxuICBuYXZpZ2F0ZTogKHVybDogc3RyaW5nKSA9PiB2b2lkO1xyXG5cclxuICAvLyBBSSBTdGF0ZVxyXG4gIGlzUHJvY2Vzc2luZzogYm9vbGVhbjtcclxuICBjdXJyZW50TG9iZTogTG9iZTtcclxuICBleGVjdXRlQ29tbWFuZDogKGNvbW1hbmQ6IHN0cmluZykgPT4gUHJvbWlzZTxzdHJpbmc+O1xyXG59XHJcblxyXG5jb25zdCBDb21ldENvbnRleHQgPSBjcmVhdGVDb250ZXh0PENvbWV0Q29udGV4dFR5cGUgfCBudWxsPihudWxsKTtcclxuXHJcbi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4vLyDwn6egIFRIUkVFLUxPQkUgQVJDSElURUNUVVJFXHJcbi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG5cclxuLyoqXHJcbiAqIFNFTlNPUlkgTE9CRSAtIElucHV0IEZpbHRlciAmIFNlY3VyaXR5XHJcbiAqL1xyXG5jb25zdCBzZW5zb3J5TG9iZSA9IHtcclxuICBwcm9jZXNzOiAoaW5wdXQ6IHN0cmluZyk6IHsgc2FmZTogYm9vbGVhbjsgc2FuaXRpemVkOiBzdHJpbmc7IGludGVudDogc3RyaW5nIH0gPT4ge1xyXG4gICAgLy8gU2VjdXJpdHkgY2hlY2tcclxuICAgIGNvbnN0IGRhbmdlcm91c1BhdHRlcm5zID0gWy88c2NyaXB0L2dpLCAvamF2YXNjcmlwdDovZ2ksIC9ldmFsXFwoL2dpXTtcclxuICAgIGNvbnN0IHNhZmUgPSAhZGFuZ2Vyb3VzUGF0dGVybnMuc29tZShwID0+IHAudGVzdChpbnB1dCkpO1xyXG5cclxuICAgIC8vIEludGVudCBkZXRlY3Rpb25cclxuICAgIGxldCBpbnRlbnQgPSAndW5rbm93bic7XHJcbiAgICBpZiAoaW5wdXQuc3RhcnRzV2l0aCgnY29tZXQgJykgfHwgaW5wdXQuc3RhcnRzV2l0aCgnY29tZXQgbWlzc2lvbicpKSB7XHJcbiAgICAgIGludGVudCA9ICdjb21tYW5kJztcclxuICAgIH0gZWxzZSBpZiAoaW5wdXQuaW5jbHVkZXMoJz8nKSkge1xyXG4gICAgICBpbnRlbnQgPSAncXVlc3Rpb24nO1xyXG4gICAgfSBlbHNlIGlmIChpbnB1dC5tYXRjaCgvXmh0dHBzPzpcXC9cXC8vKSkge1xyXG4gICAgICBpbnRlbnQgPSAnbmF2aWdhdGUnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaW50ZW50ID0gJ3NlYXJjaCc7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc2FmZSxcclxuICAgICAgc2FuaXRpemVkOiBpbnB1dC50cmltKCksXHJcbiAgICAgIGludGVudCxcclxuICAgIH07XHJcbiAgfSxcclxufTtcclxuXHJcbi8qKlxyXG4gKiBDT0dOSVRJVkUgTE9CRSAtIEFJIFByb2Nlc3NpbmcgJiBQbGFubmluZ1xyXG4gKi9cclxuY29uc3QgY29nbml0aXZlTG9iZSA9IHtcclxuICBwcm9jZXNzOiBhc3luYyAoaW5wdXQ6IHN0cmluZywgaW50ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgYWN0aW9uOiBzdHJpbmc7IHBhcmFtczogYW55IH0+ID0+IHtcclxuICAgIC8vIFBhcnNlIGNvbW1hbmRzXHJcbiAgICBpZiAoaW50ZW50ID09PSAnY29tbWFuZCcpIHtcclxuICAgICAgY29uc3QgcGFydHMgPSBpbnB1dC5yZXBsYWNlKC9eY29tZXQgKG1pc3Npb24gKT8vaSwgJycpLnNwbGl0KCcgJyk7XHJcbiAgICAgIGNvbnN0IGFjdGlvbiA9IHBhcnRzWzBdO1xyXG4gICAgICBjb25zdCBwYXJhbXMgPSBwYXJ0cy5zbGljZSgxKS5qb2luKCcgJyk7XHJcblxyXG4gICAgICBzd2l0Y2ggKGFjdGlvbikge1xyXG4gICAgICAgIGNhc2UgJ29wZW4nOlxyXG4gICAgICAgIGNhc2UgJ2dvdG8nOlxyXG4gICAgICAgICAgcmV0dXJuIHsgYWN0aW9uOiAnbmF2aWdhdGUnLCBwYXJhbXM6IHsgdXJsOiBwYXJhbXMgfSB9O1xyXG4gICAgICAgIGNhc2UgJ3NlYXJjaCc6XHJcbiAgICAgICAgICByZXR1cm4geyBhY3Rpb246ICdzZWFyY2gnLCBwYXJhbXM6IHsgcXVlcnk6IHBhcmFtcyB9IH07XHJcbiAgICAgICAgY2FzZSAnbmV3dGFiJzpcclxuICAgICAgICAgIHJldHVybiB7IGFjdGlvbjogJ25ld3RhYicsIHBhcmFtczoge30gfTtcclxuICAgICAgICBjYXNlICdjbG9zZSc6XHJcbiAgICAgICAgICByZXR1cm4geyBhY3Rpb246ICdjbG9zZScsIHBhcmFtczoge30gfTtcclxuICAgICAgICBjYXNlICd0YWJzJzpcclxuICAgICAgICAgIHJldHVybiB7IGFjdGlvbjogJ2xpc3QtdGFicycsIHBhcmFtczoge30gfTtcclxuICAgICAgICBjYXNlICdhc2snOlxyXG4gICAgICAgICAgcmV0dXJuIHsgYWN0aW9uOiAnYWktcXVlcnknLCBwYXJhbXM6IHsgcXVlc3Rpb246IHBhcmFtcyB9IH07XHJcbiAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgIHJldHVybiB7IGFjdGlvbjogJ3Vua25vd24nLCBwYXJhbXM6IHsgcmF3OiBpbnB1dCB9IH07XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoaW50ZW50ID09PSAnbmF2aWdhdGUnKSB7XHJcbiAgICAgIHJldHVybiB7IGFjdGlvbjogJ25hdmlnYXRlJywgcGFyYW1zOiB7IHVybDogaW5wdXQgfSB9O1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChpbnRlbnQgPT09ICdzZWFyY2gnKSB7XHJcbiAgICAgIHJldHVybiB7IGFjdGlvbjogJ3NlYXJjaCcsIHBhcmFtczogeyBxdWVyeTogaW5wdXQgfSB9O1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7IGFjdGlvbjogJ2FpLXF1ZXJ5JywgcGFyYW1zOiB7IHF1ZXN0aW9uOiBpbnB1dCB9IH07XHJcbiAgfSxcclxufTtcclxuXHJcbi8qKlxyXG4gKiBFWEVDVVRJVkUgTE9CRSAtIEFjdGlvbiBFeGVjdXRpb25cclxuICovXHJcbmNvbnN0IGV4ZWN1dGl2ZUxvYmUgPSB7XHJcbiAgZXhlY3V0ZTogYXN5bmMgKFxyXG4gICAgYWN0aW9uOiBzdHJpbmcsXHJcbiAgICBwYXJhbXM6IGFueSxcclxuICAgIGNvbnRleHQ6IHtcclxuICAgICAgY3JlYXRlVGFiOiAodXJsPzogc3RyaW5nKSA9PiB2b2lkO1xyXG4gICAgICBjbG9zZVRhYjogKGlkOiBzdHJpbmcpID0+IHZvaWQ7XHJcbiAgICAgIG5hdmlnYXRlOiAodXJsOiBzdHJpbmcpID0+IHZvaWQ7XHJcbiAgICAgIHRhYnM6IFRhYltdO1xyXG4gICAgICBhY3RpdmVUYWJJZDogc3RyaW5nIHwgbnVsbDtcclxuICAgIH1cclxuICApOiBQcm9taXNlPHN0cmluZz4gPT4ge1xyXG4gICAgc3dpdGNoIChhY3Rpb24pIHtcclxuICAgICAgY2FzZSAnbmF2aWdhdGUnOlxyXG4gICAgICAgIGNvbnN0IHVybCA9IHBhcmFtcy51cmwuc3RhcnRzV2l0aCgnaHR0cCcpID8gcGFyYW1zLnVybCA6IGBodHRwczovLyR7cGFyYW1zLnVybH1gO1xyXG4gICAgICAgIGNvbnRleHQubmF2aWdhdGUodXJsKTtcclxuICAgICAgICByZXR1cm4gYOKckyBOYXZpZ2F0aW5nIHRvOiAke3VybH1gO1xyXG5cclxuICAgICAgY2FzZSAnc2VhcmNoJzpcclxuICAgICAgICBjb25zdCBzZWFyY2hVcmwgPSBgaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9zZWFyY2g/cT0ke2VuY29kZVVSSUNvbXBvbmVudChwYXJhbXMucXVlcnkpfWA7XHJcbiAgICAgICAgY29udGV4dC5uYXZpZ2F0ZShzZWFyY2hVcmwpO1xyXG4gICAgICAgIHJldHVybiBg4pyTIFNlYXJjaGluZyBmb3I6ICR7cGFyYW1zLnF1ZXJ5fWA7XHJcblxyXG4gICAgICBjYXNlICduZXd0YWInOlxyXG4gICAgICAgIGNvbnRleHQuY3JlYXRlVGFiKCk7XHJcbiAgICAgICAgcmV0dXJuICfinJMgTmV3IHRhYiBjcmVhdGVkJztcclxuXHJcbiAgICAgIGNhc2UgJ2Nsb3NlJzpcclxuICAgICAgICBpZiAoY29udGV4dC5hY3RpdmVUYWJJZCkge1xyXG4gICAgICAgICAgY29udGV4dC5jbG9zZVRhYihjb250ZXh0LmFjdGl2ZVRhYklkKTtcclxuICAgICAgICAgIHJldHVybiAn4pyTIFRhYiBjbG9zZWQnO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJ+KclyBObyBhY3RpdmUgdGFiIHRvIGNsb3NlJztcclxuXHJcbiAgICAgIGNhc2UgJ2xpc3QtdGFicyc6XHJcbiAgICAgICAgY29uc3QgdGFiTGlzdCA9IGNvbnRleHQudGFic1xyXG4gICAgICAgICAgLm1hcCgodCwgaSkgPT4gYCR7aSArIDF9LiAke3QudGl0bGUgfHwgJ05ldyBUYWInfSAtICR7dC51cmwgfHwgJ2NvbWV0Oi8vbmV3dGFiJ31gKVxyXG4gICAgICAgICAgLmpvaW4oJ1xcbicpO1xyXG4gICAgICAgIHJldHVybiBg8J+TkSBPcGVuIFRhYnM6XFxuJHt0YWJMaXN0fWA7XHJcblxyXG4gICAgICBjYXNlICdhaS1xdWVyeSc6XHJcbiAgICAgICAgLy8gQ29ubmVjdCB0byBCcmFpbiBBUEkgZm9yIEFJIHF1ZXJpZXNcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtCUkFJTl9BUEl9L21pc3Npb25gLCB7XHJcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBjb21tYW5kOiBwYXJhbXMucXVlc3Rpb24gfSlcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcclxuICAgICAgICAgIHJldHVybiBg8J+noCBBSSBSZXNwb25zZTpcXG4ke2RhdGEuZmluYWxfcmVzcG9uc2UgfHwgZGF0YS5zdGF0dXN9YDtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgcmV0dXJuIGDwn6egIEFJIFJlc3BvbnNlIChPZmZsaW5lIE1vZGUpOlxcbkJhY2tlbmQgbm90IGF2YWlsYWJsZS4gUHJvY2Vzc2luZyBsb2NhbGx5Li4uXFxuXFxuUXVlc3Rpb246IFwiJHtwYXJhbXMucXVlc3Rpb259XCJgO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgcmV0dXJuIGDinZMgVW5rbm93biBjb21tYW5kLiBUeXBlICdoZWxwJyBmb3IgYXZhaWxhYmxlIGNvbW1hbmRzLmA7XHJcbiAgICB9XHJcbiAgfSxcclxufTtcclxuXHJcbi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxyXG4vLyDwn5qAIFBST1ZJREVSIENPTVBPTkVOVFxyXG4vLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcclxuXHJcbmV4cG9ydCBjb25zdCBDb21ldFByb3ZpZGVyOiBSZWFjdC5GQzx7IGNoaWxkcmVuOiBSZWFjdE5vZGUgfT4gPSAoeyBjaGlsZHJlbiB9KSA9PiB7XHJcbiAgLy8gVGFiIFN0YXRlXHJcbiAgY29uc3QgW3RhYnMsIHNldFRhYnNdID0gdXNlU3RhdGU8VGFiW10+KFtcclxuICAgIHsgaWQ6IHV1aWR2NCgpLCB1cmw6ICdjb21ldDovL25ld3RhYicsIHRpdGxlOiAnTmV3IFRhYicsIGlzTG9hZGluZzogZmFsc2UgfSxcclxuICBdKTtcclxuICBjb25zdCBbYWN0aXZlVGFiSWQsIHNldEFjdGl2ZVRhYklkXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KHRhYnNbMF0/LmlkIHx8IG51bGwpO1xyXG5cclxuICAvLyBBSSBTdGF0ZVxyXG4gIGNvbnN0IFtpc1Byb2Nlc3NpbmcsIHNldElzUHJvY2Vzc2luZ10gPSB1c2VTdGF0ZShmYWxzZSk7XHJcbiAgY29uc3QgW2N1cnJlbnRMb2JlLCBzZXRDdXJyZW50TG9iZV0gPSB1c2VTdGF0ZTxMb2JlPihudWxsKTtcclxuXHJcbiAgLy8gVGFiIEFjdGlvbnNcclxuICBjb25zdCBzZXRBY3RpdmVUYWIgPSB1c2VDYWxsYmFjaygoaWQ6IHN0cmluZykgPT4ge1xyXG4gICAgc2V0QWN0aXZlVGFiSWQoaWQpO1xyXG4gIH0sIFtdKTtcclxuXHJcbiAgY29uc3QgY3JlYXRlVGFiID0gdXNlQ2FsbGJhY2soKHVybD86IHN0cmluZykgPT4ge1xyXG4gICAgY29uc3QgbmV3VGFiOiBUYWIgPSB7XHJcbiAgICAgIGlkOiB1dWlkdjQoKSxcclxuICAgICAgdXJsOiB1cmwgfHwgJ2NvbWV0Oi8vbmV3dGFiJyxcclxuICAgICAgdGl0bGU6IHVybCA/ICdMb2FkaW5nLi4uJyA6ICdOZXcgVGFiJyxcclxuICAgICAgaXNMb2FkaW5nOiAhIXVybCxcclxuICAgIH07XHJcbiAgICBzZXRUYWJzKHByZXYgPT4gWy4uLnByZXYsIG5ld1RhYl0pO1xyXG4gICAgc2V0QWN0aXZlVGFiSWQobmV3VGFiLmlkKTtcclxuICB9LCBbXSk7XHJcblxyXG4gIGNvbnN0IGNsb3NlVGFiID0gdXNlQ2FsbGJhY2soKGlkOiBzdHJpbmcpID0+IHtcclxuICAgIHNldFRhYnMocHJldiA9PiB7XHJcbiAgICAgIGNvbnN0IG5ld1RhYnMgPSBwcmV2LmZpbHRlcih0ID0+IHQuaWQgIT09IGlkKTtcclxuICAgICAgaWYgKG5ld1RhYnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgLy8gQWx3YXlzIGtlZXAgYXQgbGVhc3Qgb25lIHRhYlxyXG4gICAgICAgIGNvbnN0IG5ld1RhYjogVGFiID0ge1xyXG4gICAgICAgICAgaWQ6IHV1aWR2NCgpLFxyXG4gICAgICAgICAgdXJsOiAnY29tZXQ6Ly9uZXd0YWInLFxyXG4gICAgICAgICAgdGl0bGU6ICdOZXcgVGFiJyxcclxuICAgICAgICAgIGlzTG9hZGluZzogZmFsc2UsXHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gW25ld1RhYl07XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIG5ld1RhYnM7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBVcGRhdGUgYWN0aXZlIHRhYiBpZiBuZWVkZWRcclxuICAgIGlmIChhY3RpdmVUYWJJZCA9PT0gaWQpIHtcclxuICAgICAgc2V0VGFicyhwcmV2ID0+IHtcclxuICAgICAgICBjb25zdCBpbmRleCA9IHByZXYuZmluZEluZGV4KHQgPT4gdC5pZCA9PT0gaWQpO1xyXG4gICAgICAgIGNvbnN0IG5ld0FjdGl2ZUlkID0gcHJldltpbmRleCAtIDFdPy5pZCB8fCBwcmV2W2luZGV4ICsgMV0/LmlkIHx8IHByZXZbMF0/LmlkO1xyXG4gICAgICAgIHNldEFjdGl2ZVRhYklkKG5ld0FjdGl2ZUlkKTtcclxuICAgICAgICByZXR1cm4gcHJldjtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfSwgW2FjdGl2ZVRhYklkXSk7XHJcblxyXG4gIGNvbnN0IG5hdmlnYXRlID0gdXNlQ2FsbGJhY2soKHVybDogc3RyaW5nKSA9PiB7XHJcbiAgICBpZiAoIWFjdGl2ZVRhYklkKSB7XHJcbiAgICAgIGNyZWF0ZVRhYih1cmwpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgc2V0VGFicyhwcmV2ID0+XHJcbiAgICAgIHByZXYubWFwKHQgPT5cclxuICAgICAgICB0LmlkID09PSBhY3RpdmVUYWJJZFxyXG4gICAgICAgICAgPyB7IC4uLnQsIHVybCwgdGl0bGU6ICdMb2FkaW5nLi4uJywgaXNMb2FkaW5nOiB0cnVlIH1cclxuICAgICAgICAgIDogdFxyXG4gICAgICApXHJcbiAgICApO1xyXG4gIH0sIFthY3RpdmVUYWJJZCwgY3JlYXRlVGFiXSk7XHJcblxyXG4gIC8vIFRocmVlLUxvYmUgQ29tbWFuZCBFeGVjdXRpb25cclxuICBjb25zdCBleGVjdXRlQ29tbWFuZCA9IHVzZUNhbGxiYWNrKGFzeW5jIChjb21tYW5kOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4gPT4ge1xyXG4gICAgc2V0SXNQcm9jZXNzaW5nKHRydWUpO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIDEuIFNFTlNPUlkgTE9CRSAtIElucHV0IHByb2Nlc3NpbmdcclxuICAgICAgc2V0Q3VycmVudExvYmUoJ3NlbnNvcnknKTtcclxuICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIDIwMCkpOyAvLyBWaXN1YWwgZGVsYXlcclxuICAgICAgY29uc3Qgc2Vuc29yeVJlc3VsdCA9IHNlbnNvcnlMb2JlLnByb2Nlc3MoY29tbWFuZCk7XHJcblxyXG4gICAgICBpZiAoIXNlbnNvcnlSZXN1bHQuc2FmZSkge1xyXG4gICAgICAgIHNldEN1cnJlbnRMb2JlKG51bGwpO1xyXG4gICAgICAgIHNldElzUHJvY2Vzc2luZyhmYWxzZSk7XHJcbiAgICAgICAgcmV0dXJuICfwn5uh77iPIFNFQ1VSSVRZOiBQb3RlbnRpYWxseSB1bnNhZmUgaW5wdXQgYmxvY2tlZC4nO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyAyLiBDT0dOSVRJVkUgTE9CRSAtIFBsYW5uaW5nXHJcbiAgICAgIHNldEN1cnJlbnRMb2JlKCdjb2duaXRpdmUnKTtcclxuICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIDMwMCkpOyAvLyBWaXN1YWwgZGVsYXlcclxuICAgICAgY29uc3QgY29nbml0aXZlUmVzdWx0ID0gYXdhaXQgY29nbml0aXZlTG9iZS5wcm9jZXNzKFxyXG4gICAgICAgIHNlbnNvcnlSZXN1bHQuc2FuaXRpemVkLFxyXG4gICAgICAgIHNlbnNvcnlSZXN1bHQuaW50ZW50XHJcbiAgICAgICk7XHJcblxyXG4gICAgICAvLyAzLiBFWEVDVVRJVkUgTE9CRSAtIEV4ZWN1dGlvblxyXG4gICAgICBzZXRDdXJyZW50TG9iZSgnZXhlY3V0aXZlJyk7XHJcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHIgPT4gc2V0VGltZW91dChyLCAyMDApKTsgLy8gVmlzdWFsIGRlbGF5XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGV4ZWN1dGl2ZUxvYmUuZXhlY3V0ZShjb2duaXRpdmVSZXN1bHQuYWN0aW9uLCBjb2duaXRpdmVSZXN1bHQucGFyYW1zLCB7XHJcbiAgICAgICAgY3JlYXRlVGFiLFxyXG4gICAgICAgIGNsb3NlVGFiLFxyXG4gICAgICAgIG5hdmlnYXRlLFxyXG4gICAgICAgIHRhYnMsXHJcbiAgICAgICAgYWN0aXZlVGFiSWQsXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH0gZmluYWxseSB7XHJcbiAgICAgIHNldEN1cnJlbnRMb2JlKG51bGwpO1xyXG4gICAgICBzZXRJc1Byb2Nlc3NpbmcoZmFsc2UpO1xyXG4gICAgfVxyXG4gIH0sIFtjcmVhdGVUYWIsIGNsb3NlVGFiLCBuYXZpZ2F0ZSwgdGFicywgYWN0aXZlVGFiSWRdKTtcclxuXHJcbiAgY29uc3QgdmFsdWU6IENvbWV0Q29udGV4dFR5cGUgPSB7XHJcbiAgICB0YWJzLFxyXG4gICAgYWN0aXZlVGFiSWQsXHJcbiAgICBzZXRBY3RpdmVUYWIsXHJcbiAgICBjcmVhdGVUYWIsXHJcbiAgICBjbG9zZVRhYixcclxuICAgIG5hdmlnYXRlLFxyXG4gICAgaXNQcm9jZXNzaW5nLFxyXG4gICAgY3VycmVudExvYmUsXHJcbiAgICBleGVjdXRlQ29tbWFuZCxcclxuICB9O1xyXG5cclxuICByZXR1cm4gKFxyXG4gICAgPENvbWV0Q29udGV4dC5Qcm92aWRlciB2YWx1ZT17dmFsdWV9PlxyXG4gICAgICB7Y2hpbGRyZW59XHJcbiAgICA8L0NvbWV0Q29udGV4dC5Qcm92aWRlcj5cclxuICApO1xyXG59O1xyXG5cclxuLy8gSG9va1xyXG5leHBvcnQgY29uc3QgdXNlQ29tZXQgPSAoKTogQ29tZXRDb250ZXh0VHlwZSA9PiB7XHJcbiAgY29uc3QgY29udGV4dCA9IHVzZUNvbnRleHQoQ29tZXRDb250ZXh0KTtcclxuICBpZiAoIWNvbnRleHQpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcigndXNlQ29tZXQgbXVzdCBiZSB1c2VkIHdpdGhpbiBDb21ldFByb3ZpZGVyJyk7XHJcbiAgfVxyXG4gIHJldHVybiBjb250ZXh0O1xyXG59O1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgQ29tZXRDb250ZXh0O1xyXG4iXSwiZmlsZSI6IkM6L1VzZXJzL2FkbWluL0Rlc2t0b3AvSElMT19DQVNFL0NvbWV0LVgvc3JjL2NvbnRleHQvQ29tZXRDb250ZXh0LnRzeCJ9